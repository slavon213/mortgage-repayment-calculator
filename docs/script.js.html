<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: script.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: script.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Основна форма калькулятора, перша форма на сторінці.
 * @type {HTMLFormElement}
 */
const formCalculator = document.forms[0];

/**
 * Кнопка для очищення всіх введених даних у формі.
 * @type {HTMLButtonElement}
 */
const buttonClear = document.getElementById("clearAll");

/**
 * Поле введення суми кредиту.
 * @type {HTMLInputElement}
 */
const amountInput = document.getElementById("amount");

/**
 * Поле введення терміну кредиту.
 * @type {HTMLInputElement}
 */
const termInput = document.getElementById("term");

/**
 * Поле введення відсоткової ставки.
 * @type {HTMLInputElement}
 */
const rateInput = document.getElementById("rate");

/**
 * Масив основних полів введення: сума, термін, ставка.
 * @type {HTMLInputElement[]}
 */
const inputFields = document.querySelectorAll("input[type='text']");

/**
 * Колекція радіо-кнопок для вибору типу іпотеки.
 * @type {NodeListOf&lt;HTMLInputElement>}
 */
const buttonsMortgageType = document.querySelectorAll("input[type='radio']");

/**
 * Кнопка для запуску розрахунку іпотеки.
 * @type {HTMLButtonElement}
 */
const buttonCalculate = document.getElementById("calculate");

/**
 * Блок для відображення результатів розрахунку.
 * @type {HTMLElement}
 */
const displayBlock = document.querySelector(".half.second");

/**
 * Колекція елементів &lt;small>, для повідомлень про помилки.
 * @type {NodeListOf&lt;HTMLElement>}
 */
const smallElements = document.querySelectorAll("small");


/**
 * Світлий відтінок лаймового кольору для стилізації.
 * @type {string}
 */
const colorLimeLight = "hsla(61, 70%, 76%, .25)";

/**
 * Валюта, яка використовується для розрахунків — британський фунт.
 * @type {string}
 */
const currency = "GBP";

/**
 * Локаль для форматування чисел і валюти — британський англійський.
 * @type {string}
 */
const currentLocale = "en-GB";

/**
 * Створює та відображає порожній блок результатів у калькуляторі.
 *
 * Функція генерує HTML-блок із зображенням, заголовком і текстом-підказкою,
 * який показується у контейнері `displayBlock`, коли користувач ще не заповнив форму.
 * Встановлюється стилізація для центрування вмісту.
 *
 * @function
 * @returns {void}
 */
const emptyResult = () => {
    const emptyResultDiv = document.createElement("div");
    emptyResultDiv.classList.add("pending");
    emptyResultDiv.classList.add("grd");
    emptyResultDiv.innerHTML = `
    &lt;img src="./assets/images/illustration-empty.svg" alt="">
                        &lt;h2 class="text-preset-2">Results shown here&lt;/h2>
                        &lt;p class="text-preset-4">
                            Complete the form and click “calculate repayments” to see what your monthly repayments would
                            be.
                        &lt;/p>
    `;
    displayBlock.style.placeContent = "center";
    displayBlock.appendChild(emptyResultDiv);
};


buttonClear.addEventListener("click", clearForm);

buttonCalculate.addEventListener("click", () => {
    mainProcess();
});

/**
 * Додає обробник події для input type "radio"
 * 
 * Змінює фоновий колір контейнера , в якому міститься input type="radio"
 * 
 * @event click
 */
buttonsMortgageType.forEach((button) => {
    button.addEventListener("click", function () {
        const inputContainer = this.closest("label");

        clearRadioBackground(buttonsMortgageType, "label");
        if (this.checked) {
            inputContainer.style.backgroundColor = colorLimeLight;
        }
    });
});


/**
 * Додає обробник "input"  і "blur"  до полів вводу
 * 
 * Змінює колір фону в сусдініх елементах span
 * 
 * @event
 */
inputFields.forEach((thisInput) => {
    thisInput.addEventListener("input", function () {
        addBgOnInput(this);
    });
    thisInput.addEventListener("blur", function () {
        removeBgOnBlur(this);
    });
});

/**
 * Очищає блок відображення рорахунків
 */
function clearDisplayBlock() {
    displayBlock.innerHTML = "";
}

/**
 * Очищає поля відображення помилок валідації
 * @param {HTMLInputElement} elements 
 * @param {HTMLLabelElement} parent 
 * @returns void
 */
function clearErrors(elements, parent) {
    elements.forEach((element) => {
        const parentLabel = element.closest("label");
        parentLabel.classList.remove("invalid");
        parentLabel.classList.remove("invalid-prefix-suffix");
    });
}

/**
 * Очищає всі поля форми
 */
function clearForm() {
    formCalculator.reset();
    clearChecked(buttonsMortgageType);
    clearErrors(inputFields, "label");
    clearTextContent(smallElements);
    clearRadioBackground(buttonsMortgageType, "label");
    clearDisplayBlock();
    emptyResult();
}

/**
 * Знімає стан "checked"  в елементів
 * @param {HTMLInputElement} elements 
 */
function clearChecked(elements) {
    elements.forEach((element) => {
        element.checked = false;
    });
}
/**
 * Очищає текстовий контент елементів
 * @param {HTMLElement} elements 
 *
 * Основний процес розрахунку іпотеки: валідація, обчислення та виведення результатів.
 *
 * 1. Перевіряє всі текстові поля (`inputFields`) на заповнення.
 * 2. Перевіряє, чи вибрано тип іпотеки через `buttonsMortgageType`.
 * 3. Якщо всі поля валідні:
 *    - зчитує значення суми, терміну, ставки та типу іпотеки,
 *    - викликає `calculate` для обчислення щомісячного платежу та загальної суми,
 *    - передає результати у `showResult` для відображення.
 *
 * @returns {void}
 *
 * @example
 * mainProcess(); // запускає повний цикл розрахунку
 */
function clearTextContent(elements) {
    elements.forEach((element) => (element.textContent = ""));
}
/**
 * Очищає фоновий колір у батьківського елемента
 * @param {HTMLInputElement} elements 
 * @param {HTMLElement} parent 
 */
function clearRadioBackground(elements, parent) {
    elements.forEach((element) => {
        const parentElement = element.closest(parent);
        parentElement.style.backgroundColor = "";
    });
}

/**
 * Очищає введене значення та обмежує його до десяткового числа з двома знаками після крапки.
 *
 * Функція видаляє всі символи, крім цифр і крапки, обмежує кількість десяткових крапок до однієї,
 * і скорочує дробову частину до максимум двох цифр.
 *
 * @param {string} value - Вхідне значення, яке потрібно обробити.
 * @returns {string} - Відформатоване десяткове число у вигляді рядка.
 *
 * @example
 * decimalInput("123.4567") // "123.45"
 * decimalInput("12.3.4")    // "12.34"
 * decimalInput("abc99.9")   // "99.9"
 */
function decimalInput(value) {
    value = value.replace(/[^\d.]+/g, "");
    const parts = value.split(".");

    if (parts.length > 2) {
        value = parts[0] + "." + parts.slice(1, 3).join("");
    }

    if (value.includes(".")) {
        const dotIndex = value.indexOf(".");
        const intPart = value.substring(0, dotIndex);
        let decimalPart = value.substring(dotIndex + 1);

        if (decimalPart.length > 2) {
            decimalPart = decimalPart.substring(0, 2);
        }

        value = intPart + "." + decimalPart;
    }

    return value;
}

/**
 * Очищає введене значення, залишаючи лише цифри.
 *
 * Видаляє всі нецифрові символи з рядка, включаючи пробіли, літери та спецсимволи.
 * Підходить для обробки цілочисельних полів, таких як термін кредиту або кількість місяців.
 *
 * @param {string} value - Вхідне значення, яке потрібно обробити.
 * @returns {string} - Рядок, що містить лише цифри.
 *
 * @example
 * integerInput("12abc")   // "12"
 * integerInput("£99.99")  // "9999"
 * integerInput("term 30") // "30"
 */
function integerInput(value) {
    value = value.replace(/[^\d]+/g, "");
    return value;
}

/**
 * Додає клас "active" до внутрішнього елемента &lt;span> всередині &lt;label>, що містить передане поле.
 *
 * Використовується для візуального підсвічування при взаємодії з полем вводу.
 * Передбачається, що структура HTML має &lt;label>, всередині якого є &lt;span> для стилізації.
 *
 * @param {HTMLInputElement} element - Елемент вводу, який викликав подію.
 * @returns {void}
 *
 * @example
 * addBgOnInput(document.getElementById("amount"));
 */
function addBgOnInput(element) {
    const parent = element.closest("label");
    const innerSpan = parent.querySelector("span");
    innerSpan.classList.add("active");
}
/**
 * Видаляє клас "active" з внутрішнього елемента &lt;span> всередині &lt;label>, що містить передане поле.
 *
 * Використовується для зняття візуального підсвічування, коли поле вводу втрачає фокус.
 * Передбачається, що HTML-структура містить &lt;label> з &lt;span> для стилізації.
 *
 * @param {HTMLInputElement} element - Елемент вводу, який втратив фокус.
 * @returns {void}
 *
 * @example
 * removeBgOnBlur(document.getElementById("term"));
 */
function removeBgOnBlur(element) {
    const parent = element.closest("label");
    const innerSpan = parent.querySelector("span");
    innerSpan.classList.remove("active");
}


amountInput.addEventListener("input", function () {
    this.value = integerInput(this.value);
});

termInput.addEventListener("input", function () {
    this.value = integerInput(this.value).substring(0, 2);
});

rateInput.addEventListener("input", function () {
    this.value = decimalInput(this.value).substring(0, 5);
});


/**
 * Отримує тип іпотеки, вибраний користувачем через радіо-кнопки.
 *
 * Функція шукає активну (checked) радіо-кнопку з колекції `buttonsMortgageType`
 * і повертає значення її атрибута `data-option`, яке вказує на тип розрахунку —
 * наприклад, "repayment" або "interest-only".
 *
 * @returns {string|undefined} - Вибраний тип іпотеки або `undefined`, якщо нічого не вибрано.
 *
 * @example
 * getRepaymentType(); // "repayment"
 */
function getRepaymentType() {
    const buttonChecked = [...buttonsMortgageType].filter((button) => button.checked);
    let result = buttonChecked[0].dataset?.option;
    return result;
}
/**
 * Розраховує щомісячний платіж і загальну суму виплат за іпотекою.
 *
 * Підтримує два типи іпотеки:
 * - "repayment": класичний ануїтетний платіж з поступовим погашенням основної суми.
 * - "interest": лише виплата відсотків без погашення основної суми.
 *
 * @param {number} amount - Сума кредиту (основна сума).
 * @param {number} term - Термін кредиту в роках.
 * @param {number} rate - Річна процентна ставка (у відсотках).
 * @param {string} [mortgageType="repayment"] - Тип іпотеки: "repayment" або "interest".
 * @returns {string[]} - Масив з двох значень:
 *   [0] — щомісячний платіж (округлений до 2 знаків),
 *   [1] — загальна сума виплат за весь термін (округлена до 2 знаків).
 *
 * @example
 * calculate(100000, 25, 5); // ["584.59", "175376.52"]
 * calculate(100000, 25, 5, "interest"); // ["416.67", "125000.00"]
 */
function calculate(amount, term, rate, mortgageType = "repayment") {
    let monthlyPayment;
    let repayOver;
    const monthTerm = term * 12;

    const monthlyRate = rate / 100 / 12;
    if (mortgageType === "repayment") {
        monthlyPayment = (amount * monthlyRate * (1 + monthlyRate) ** monthTerm) / ((1 + monthlyRate) ** monthTerm - 1);
    } else if (mortgageType === "interest") {
        monthlyPayment = amount * monthlyRate;
    }
    repayOver = monthlyPayment * monthTerm;
    return [monthlyPayment.toFixed(2), repayOver.toFixed(2)];
}

/**
 * Перевіряє, чи заповнене поле вводу, і оновлює відповідні стилі та повідомлення.
 *
 * Якщо поле порожнє:
 * - додає класи "invalid" та "invalid-prefix-suffix" до &lt;label>,
 * - показує повідомлення "This field is required" у сусідньому &lt;small>.
 *
 * Якщо поле заповнене:
 * - прибирає стилі помилки,
 * - очищає повідомлення.
 *
 * @param {HTMLInputElement} element - Елемент вводу, який потрібно перевірити.
 * @returns {boolean} - `true`, якщо поле заповнене; `false`, якщо порожнє.
 *
 * @example
 * isValidInput(document.getElementById("amount")); // true або false
 */
function isValidInput(element) {
    const parentLabel = element.closest("label");
    const smallElement = parentLabel.nextElementSibling;
    if (!element.value) {
        smallElement.textContent = "This field is required";
        parentLabel.classList.add("invalid");
        parentLabel.classList.add("invalid-prefix-suffix");
        return false;
    } else {
        smallElement.textContent = "";
        parentLabel.classList.remove("invalid");
        parentLabel.classList.remove("invalid-prefix-suffix");
        return true;
    }
}

/**
 * Перевіряє, чи вибрано хоча б одну радіо-кнопку з переданої колекції.
 *
 * Якщо жодна кнопка не вибрана:
 * - показує повідомлення "This field is required" у відповідному &lt;small> елементі.
 *
 * Якщо хоча б одна кнопка вибрана:
 * - очищає повідомлення про помилку.
 *
 * @param {NodeListOf&lt;HTMLInputElement>} elements - Колекція радіо-кнопок для перевірки.
 * @returns {boolean|undefined} - `true`, якщо вибрано хоча б одну кнопку; `false`, якщо жодну; `undefined`, якщо колекція порожня.
 *
 * @example
 * isValidRadioElements(document.querySelectorAll("input[type='radio']")); // true або false
 */
function isValidRadioElements(elements) {
    if (elements.length > 0) {
        const noneChecked = [...elements].every((element) => !element.checked);

        const parentLabel = elements[0].closest("label");
        const smallElement = parentLabel.nextElementSibling.nextElementSibling;
        if (noneChecked) {
            smallElement.textContent = "This field is required";
            return false;
        } else {
            smallElement.textContent = "";
            return true;
        }
    }
}


/**
 * Виводить результати розрахунку іпотеки у форматі валюти та оновлює інтерфейс.
 *
 * Форматує щомісячний платіж і загальну суму виплат згідно з локаллю `currentLocale` та валютою `currency`.
 * Очищає попередній вміст блоку результатів, створює новий HTML-блок з результатами і додає його до `displayBlock`.
 *
 * @param {string|number} monthly - Щомісячний платіж (може бути числом або рядком).
 * @param {string|number} total - Загальна сума виплат за термін (може бути числом або рядком).
 * @returns {void}
 *
 * @example
 * showResult("584.59", "175376.52");
 */
function showResult(monthly, total) {
    const formattedMonthly = new Intl.NumberFormat(currentLocale, {
        style: "currency",
        currency: currency,
    }).format(monthly);
    const formattedTotal = new Intl.NumberFormat(currentLocale, {
        style: "currency",
        currency: currency,
    }).format(total);

    clearDisplayBlock();
    const resultDiv = document.createElement("div");
    resultDiv.classList.add("grd");
    resultDiv.classList.add("result");
    resultDiv.innerHTML = `&lt;div>
                            &lt;h2 class="text-preset-2">Your results&lt;/h2>
                            &lt;p class="text-preset-4">
                                Your results are shown below based on the information you provided. To adjust the results,
                                edit the form and click “calculate repayments” again.
                            &lt;/p>
                        &lt;/div>
                        &lt;div class="card grd">
                            &lt;div>
                                &lt;p class="text-preset-4">Your monthly repayments&lt;/p>
                                &lt;p>&lt;span class="text-preset-1 big-numbers">${formattedMonthly}&lt;/span>&lt;/p>
                            &lt;/div>
                            &lt;hr>
                            &lt;div>
                                &lt;p class="text-preset-4">Total you'll repay over the term&lt;/p>
                                &lt;p>&lt;span class="text-preset-2 small-numbers">${formattedTotal}&lt;/span>&lt;/p>
                            &lt;/div>
                        &lt;/div>`;
    displayBlock.style.placeContent = "start";
    displayBlock.appendChild(resultDiv);
}
/**
 * Основний процес розрахунку іпотеки: валідація, обчислення та виведення результатів.
 *
 * 1. Перевіряє всі текстові поля (`inputFields`) на заповнення.
 * 2. Перевіряє, чи вибрано тип іпотеки через `buttonsMortgageType`.
 * 3. Якщо всі поля валідні:
 *    - зчитує значення суми, терміну, ставки та типу іпотеки,
 *    - викликає `calculate` для обчислення щомісячного платежу та загальної суми,
 *    - передає результати у `showResult` для відображення.
 *
 * @returns {void}
 *
 * @example
 * mainProcess(); // запускає повний цикл розрахунку
 */
function mainProcess() {
    const validFields = [...inputFields].map((field) => isValidInput(field));
    const allValidRadioButtons = isValidRadioElements(buttonsMortgageType);
    const allValidFields = validFields.every((field) => field);

    if (allValidRadioButtons &amp;&amp; allValidFields) {
        const amount = parseInt(amountInput.value);
        const years = parseInt(termInput.value);
        const interest = parseFloat(rateInput.value);
        const mortgageType = getRepaymentType();

        const [monthly, total] = calculate(amount, years, interest, mortgageType);
        showResult(monthly, total);
    }
}

emptyResult();
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Events</h3><ul><li><a href="global.html#event:click">click</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addBgOnInput">addBgOnInput</a></li><li><a href="global.html#amountInput">amountInput</a></li><li><a href="global.html#buttonCalculate">buttonCalculate</a></li><li><a href="global.html#buttonClear">buttonClear</a></li><li><a href="global.html#buttonsMortgageType">buttonsMortgageType</a></li><li><a href="global.html#calculate">calculate</a></li><li><a href="global.html#clearChecked">clearChecked</a></li><li><a href="global.html#clearDisplayBlock">clearDisplayBlock</a></li><li><a href="global.html#clearErrors">clearErrors</a></li><li><a href="global.html#clearForm">clearForm</a></li><li><a href="global.html#clearRadioBackground">clearRadioBackground</a></li><li><a href="global.html#clearTextContent">clearTextContent</a></li><li><a href="global.html#colorLimeLight">colorLimeLight</a></li><li><a href="global.html#currency">currency</a></li><li><a href="global.html#currentLocale">currentLocale</a></li><li><a href="global.html#decimalInput">decimalInput</a></li><li><a href="global.html#displayBlock">displayBlock</a></li><li><a href="global.html#emptyResult">emptyResult</a></li><li><a href="global.html#formCalculator">formCalculator</a></li><li><a href="global.html#getRepaymentType">getRepaymentType</a></li><li><a href="global.html#inputFields">inputFields</a></li><li><a href="global.html#integerInput">integerInput</a></li><li><a href="global.html#isValidInput">isValidInput</a></li><li><a href="global.html#isValidRadioElements">isValidRadioElements</a></li><li><a href="global.html#mainProcess">mainProcess</a></li><li><a href="global.html#rateInput">rateInput</a></li><li><a href="global.html#removeBgOnBlur">removeBgOnBlur</a></li><li><a href="global.html#showResult">showResult</a></li><li><a href="global.html#smallElements">smallElements</a></li><li><a href="global.html#termInput">termInput</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Wed Aug 13 2025 16:55:08 GMT+0300 (за східноєвропейським літнім часом)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
